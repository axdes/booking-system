<script>
// ============ GLOBALS ============
// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, –¥–æ—Å—Ç—É–ø–Ω—ã–µ –≤–æ –≤—Å—ë–º –ø—Ä–æ–µ–∫—Ç–µ
window.busyDates = window.busyDates || [];            // –ó–∞–Ω—è—Ç—ã–µ –¥–∞—Ç—ã (–∏–∑ Calendar)
window.config = window.config || {};                  // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
window.optionsArr = window.optionsArr || [];          // –í—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –æ–ø—Ü–∏–∏
window.includedItems = window.includedItems || [];    // –û–ø—Ü–∏–∏, –≤–∫–ª—é—á—ë–Ω–Ω—ã–µ –≤ MAX-–ø–ª–∞–Ω

// –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≥–æ—Å—Ç–µ–π –∏ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
window.adultCount = 2;
window.kidCount = 0;
window.babyCount = 0;
window.petCount = 0;
window.selectedDates = [];              // –î–∞—Ç—ã –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
window.uploadedReceiptUrl = '';         // –°—Å—ã–ª–∫–∞ –Ω–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π —á–µ–∫
window.myPlan = 'custom';               // –¢–µ–∫—É—â–∏–π –ø–ª–∞–Ω: max / relax / custom
window.secondHouseSelected = false; // –í–∫–ª—é—á—ë–Ω –ª–∏ –≤—Ç–æ—Ä–æ–π –¥–æ–º–∏–∫
window.maxMainGuests = 4;           // –ú–∞–∫—Å–∏–º—É–º –ª—é–¥–µ–π –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –¥–æ–º–µ
window.secondHouseCost = 150;       // –°—Ç–æ–∏–º–æ—Å—Ç—å –≤—Ç–æ—Ä–æ–≥–æ –¥–æ–º–∏–∫–∞

// –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–∞–ª–µ–Ω–¥–∞—Ä—è
let currentYear, currentMonth;
let minYear, minMonth;
let maxYear, maxMonth;

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ—Å–ª–µ –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ DOM
window.addEventListener('DOMContentLoaded', function () {
  const now = new Date();

  // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≥—Ä–∞–Ω–∏—Ü –∫–∞–ª–µ–Ω–¥–∞—Ä—è (2 –º–µ—Å—è—Ü–∞ –≤–ø–µ—Ä—ë–¥)
  minYear = now.getFullYear();
  minMonth = now.getMonth();
  const future = new Date(minYear, minMonth + 2, 1);
  maxYear = future.getFullYear();
  maxMonth = future.getMonth();

  currentYear = minYear;
  currentMonth = minMonth;

  // –û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–µ—Ä–≤–æ–≥–æ —à–∞–≥–∞
  renderCalendar();         // –∫–∞–ª–µ–Ω–¥–∞—Ä—å
  renderManualBase();       // —Ä—É—á–Ω–æ–π –≤—ã–±–æ—Ä –æ–ø—Ü–∏–π
  renderExtraOptions();     // –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏
  updateProgress(1);        // –≤–∏–∑—É–∞–ª—å–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å ‚Äî —à–∞–≥ 1
});


// ============ UI HELPERS / –£—Ç–∏–ª–∏—Ç—ã ============

// üîÑ –ñ–¥—ë—Ç, –ø–æ–∫–∞ —ç–ª–µ–º–µ–Ω—Ç –ø–æ—è–≤–∏—Ç—Å—è –≤ DOM, –∑–∞—Ç–µ–º –≤—ã–∑—ã–≤–∞–µ—Ç callback
function waitForElementAndInit(selector, callback) {
  const el = document.querySelector(selector);
  if (el) {
    callback();
  } else {
    setTimeout(() => waitForElementAndInit(selector, callback), 50);
  }
}

// üéØ –û–±–Ω–æ–≤–ª—è–µ—Ç –≤–∏–∑—É–∞–ª—å–Ω–æ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —à–∞–≥–∞
function updateProgress(step) {
  ['step1', 'step2', 'step3'].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.classList.remove('active');
  });

  const active = document.getElementById(`step${step}`);
  if (active) active.classList.add('active');
}

// üí∞ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å –∏ —ç–∫–æ–Ω–æ–º–∏—é
function showCalendarPriceInfo() {
  const infoDiv = document.getElementById('calendarPriceInfo');
  if (!infoDiv || window.selectedDates.length === 0) {
    infoDiv.style.display = 'none';
    return;
  }

  // –†–∞—Å—á—ë—Ç –∫–æ–ª-–≤–∞ –¥–Ω–µ–π –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
  const start = new Date(window.selectedDates[0] + 'T12:00:00');
  const end = new Date((window.selectedDates[1] || window.selectedDates[0]) + 'T12:00:00');
  const totalDays = Math.max(1, Math.ceil((end - start) / (1000 * 60 * 60 * 24)));

  let total = 0;

  for (let i = 0; i < totalDays; i++) {
    const d = new Date(start);
    d.setDate(start.getDate() + i);

    const wd = d.getDay(); // –¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏ (0‚Äì6)
    let basePrice = 0;

    if ([1, 2, 3, 4].includes(wd)) {
      basePrice = window.config.weekday_price || 0;
    } else if (wd === 5) {
      basePrice = window.config.friday_price || 0;
    } else if (wd === 6) {
      basePrice = window.config.saturday_price || 0;
    } else {
      basePrice = window.config.sunday_price || 0;
    }

    // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø–ª–∞–Ω–∞
    if (window.myPlan === 'max') {
      basePrice += 100;
    } else if (window.myPlan === 'custom') {
      basePrice -= (window.config.custom_discount || 0);
    }

    // –ë–µ–∑ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
    if (basePrice < 0) basePrice = 0;

    total += basePrice;
  }

  const prepayment = Math.round(total * 0.3); // 30% –ø—Ä–µ–¥–æ–ø–ª–∞—Ç–∞

  // –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
  let text = `–ü—Ä–∏–º–µ—Ä–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: ${total} BYN<br>–ü—Ä–µ–¥–æ–ø–ª–∞—Ç–∞: ${prepayment} BYN (30%)`;

  if (window.myPlan === 'relax') {
    text += `<br><em>–í—ã —ç–∫–æ–Ω–æ–º–∏—Ç–µ –¥–æ 150 BYN –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å —Ä—É—á–Ω—ã–º –≤—ã–±–æ—Ä–æ–º –æ–ø—Ü–∏–π</em>`;
  }

  infoDiv.innerHTML = text;
  infoDiv.style.display = 'block';
}
</script>
